<div class="h-full flex flex-col p-6 max-w-7xl mx-auto w-full">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">{{ 'RESULTS' | translate }}</h1>
        <button (click)="exportCsv()"
            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg>
            {{ 'EXPORT_CSV' | translate }}
        </button>
    </div>

    <!-- Filters -->
    <div class="bg-white p-4 rounded-lg shadow mb-6 flex flex-wrap gap-4 items-end">
        <div class="flex-1 min-w-[200px]">
            <label class="block text-sm font-medium text-gray-700 mb-1">{{ 'GROUPS' | translate }}</label>
            <select [(ngModel)]="selectedGroupId" (ngModelChange)="onFilterChange()"
                class="w-full border rounded-md py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">{{ 'ALL_GROUPS' | translate }}</option>
                @for (group of groups(); track group.id) {
                <option [value]="group.id">{{ group.name }}</option>
                }
            </select>
        </div>
        <div class="flex-1 min-w-[200px]">
            <label class="block text-sm font-medium text-gray-700 mb-1">{{ 'SEARCH_USERS' | translate }}</label>
            <input type="text" [(ngModel)]="search" (ngModelChange)="onFilterChange()"
                [placeholder]="'SEARCH_PLACEHOLDER' | translate"
                class="w-full border rounded-md py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
    </div>

    <!-- Table -->
    <div class="bg-white shadow rounded-lg overflow-hidden flex-1">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{
                            'USER' | translate }}</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{
                            'COURSE' | translate }} / {{ 'TEST' | translate }}</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{
                            'SCORE' | translate }}</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{
                            'COMPLETED_AT' | translate }}</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @for (result of results(); track result.id) {
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div>
                                    <div class="text-sm font-medium text-gray-900">{{ result.username }}</div>
                                    <div class="text-sm text-gray-500">{{ result.email }}</div>
                                    @if(result.group_name) {
                                    <div class="text-xs text-indigo-600 mt-1">{{ result.group_name }}</div>
                                    }
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-900 font-medium">{{ result.course_title }}</div>
                            <div class="text-sm text-gray-500">{{ result.test_description }}</div>
                            <div class="text-xs text-gray-400">{{ result.page_title }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">{{ result.score }} / {{ result.max_score }}</div>
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                [class.bg-green-100]="result.passed" [class.text-green-800]="result.passed"
                                [class.bg-red-100]="!result.passed" [class.text-red-800]="!result.passed">
                                {{ (result.passed ? 'PASSED' : 'FAILED') | translate }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ result.completed_at | date:'medium' }}
                        </td>
                    </tr>
                    }
                    @if (results().length === 0 && !isLoading()) {
                    <tr>
                        <td colspan="4" class="px-6 py-10 text-center text-gray-500">
                            {{ 'NO_RESULTS' | translate }}
                        </td>
                    </tr>
                    }
                    @if (isLoading()) {
                    <tr>
                        <td colspan="4" class="px-6 py-10 text-center text-gray-500">
                            Loading...
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>